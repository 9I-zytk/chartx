KISSY.add("dvix/chart/line/",function(a,b,c,d,e,f,g,h,i,j){var k=b.Canvax;window.Canvax=k;var l=function(){this.version="0.1",this.type="line",this.canvax=null,this.element=null,this.width=0,this.height=0,this.config={mode:1,event:{enabled:1}},this.dataFrameOrg={org:[],data:[],yAxis:{fields:[],org:[],section:[],data:[]},xAxis:{field:"",org:[],data:[]},graphs:{data:[],disX:0}},this.dataFrame={},this._chartWidth=0,this._chartHeight=0,this._disX=0,this._disY=6,this._disYAndO=6,this._disXAxisLine=6,this._disYAxisTopLine=6,this._disOriginX=0,this._yMaxHeight=0,this._yGraphsHeight=0,this._xMaxWidth=0,this._xGraphsWidth=0,this._baseNumber=0,this._xAxis=null,this._yAxis=null,this._back=null,this._graphs=null,this._tips=null,this.init.apply(this,arguments)};return l.prototype={init:function(a){var b=this;b.element=a,b.width=parseInt(a.width()),b.height=parseInt(a.height()),b.canvax=new k({el:b.element}),b.stage=new k.Display.Stage({id:"main",context:{x:.5,y:.5}}),b.canvax.addChild(b.stage),b.stageTip=new k.Display.Sprite({id:"tip"}),b.core=new k.Display.Sprite({id:"core"}),b.stageBg=new k.Display.Sprite({id:"bg"}),b.stage.addChild(b.stageBg),b.stage.addChild(b.core),b.stage.addChild(b.stageTip)},draw:function(a,b){var c=this;b.rotate&&c.rotate(b.rotate),c._initConfig(a,b),c._initModule(b),c._initData(),c._startDraw(),c._drawEnd(),c._arguments=arguments,window.hoho=c},clear:function(){var a=this;a.stageBg.removeAllChildren(),a.core.removeAllChildren(),a.stageTip.removeAllChildren()},rotate:function(a){var b=this,c=b.width,d=b.height;b.width=d,b.height=c,_.each(b.stage.children,function(e){e.context.rotation=a||-90,e.context.x=(c-d)/2,e.context.y=(d-c)/2,e.context.rotateOrigin.x=b.width*e.context.$model.scaleX/2,e.context.rotateOrigin.y=b.height*e.context.$model.scaleY/2})},reset:function(a,b){var c=this;c.clear(),c.width=parseInt(c.element.width()),c.height=parseInt(c.element.height()),c.draw(a,b)},_initConfig:function(b,c){var d=this;if(d.dataFrame=a.clone(d.dataFrameOrg),d.dataFrame.org=b,c){d.config.mode=c.mode||d.config.mode,d._disXAxisLine=c.disXAxisLine||0==c.disXAxisLine?c.disXAxisLine:d._disXAxisLine,d._disYAxisTopLine=c.disYAxisTopLine||0==c.disYAxisTopLine?c.disYAxisTopLine:d._disYAxisTopLine,d._disYAndO=c.disYAndO||0==c.disYAndO?c.disYAndO:d._disYAndO;var e=c.event;e&&(d.config.event.enabled=0==e.enabled?0:d.config.event.enabled);var f=c.yAxis;f&&(d.dataFrame.yAxis.fields=f.fields||d.dataFrame.yAxis.fields);var g=c.xAxis;g&&(d.dataFrame.xAxis.field=g.field||d.dataFrame.xAxis.field)}},_initModule:function(a){var b=this;b._xAxis=new f(a.xAxis),b._yAxis=new g(a.yAxis),b._back=new h(a.back),b._graphs=new i(a.graphs),b._tips=new j(a.tips)},_initData:function(){for(var a=this,b=[],c=a.dataFrame.org,d=0,e=c[0].length;e>d;d++){var f={};f.field=c[0][d],f.index=d,f.data=[],b.push(f)}for(var d=1,e=c.length;e>d;d++)for(var g=0,h=c[d].length;h>g;g++)b[g].data.push(c[d][g]);a.dataFrame.data=b;for(var c=a.dataFrame.data,d=0,e=c.length;e>d;d++){var f=c[d];if(a.dataFrame.xAxis.field)if(f.field==a.dataFrame.xAxis.field&&(a.dataFrame.xAxis.org=f.data),0==a.dataFrame.yAxis.fields.length)f.field!=a.dataFrame.xAxis.field&&a.dataFrame.yAxis.org.push(f.data);else for(var g=0,h=a.dataFrame.yAxis.fields.length;h>g;g++)f.field==a.dataFrame.yAxis.fields[g]&&(a.dataFrame.yAxis.org[g]=f.data);else if(0==d&&(a.dataFrame.xAxis.org=f.data),0==a.dataFrame.yAxis.fields.length)0!=d&&a.dataFrame.yAxis.org.push(f.data);else for(var g=0,h=a.dataFrame.yAxis.fields.length;h>g;g++)f.field==a.dataFrame.yAxis.fields[g]&&(a.dataFrame.yAxis.org[g]=f.data)}},_startDraw:function(){var a=this,b=c.getChildsArr(a.dataFrame.yAxis.org);a.dataFrame.yAxis.section=d.section(b),a._baseNumber=a.dataFrame.yAxis.section[0],1==b.length&&(a.dataFrame.yAxis.section[0]=2*b[0],a._baseNumber=0),a._chartWidth=a.width-2*a._disX,a._chartHeight=a.height-2*a._disY,a._yMaxHeight=a._chartHeight-a._xAxis.h,a._yGraphsHeight=a._yMaxHeight-a._getYAxisDisLine(),a._trimYAxis();var f=a._disX,g=this.height-a._xAxis.h-a._disY;a._yAxis.draw({data:a.dataFrame.yAxis.data}),a._yAxis.setX(f),a._yAxis.setY(g);var h=a._yAxis.w;2==a.config.mode&&(h=0,a._disYAndO=0),f=a._disX+h+a._disYAndO,a._xMaxWidth=a._chartWidth-h-a._disYAndO,a._xGraphsWidth=a._xMaxWidth-a._getXAxisDisLine(),a._disOriginX=parseInt((a._xMaxWidth-a._xGraphsWidth)/2),a._trimXAxis(),a._xAxis.draw({w:a._xMaxWidth,max:{left:-(h+a._disYAndO+a._disOriginX),right:a._xGraphsWidth+a._disOriginX},data:a.dataFrame.xAxis.data}),a._xAxis.setX(f+a._disOriginX),a._xAxis.setY(g),a._back.draw({w:a._chartWidth-h-a._disYAndO,h:g,xAxis:{data:a.dataFrame.yAxis.data}}),a._back.setX(f),a._back.setY(g),a.dataFrame.graphs.disX=a._getGraphsDisX(),a._trimGraphs(),a._graphs.draw({w:a._xGraphsWidth,h:a._yGraphsHeight,data:a.dataFrame.graphs.data,disX:a.dataFrame.graphs.disX}),a._graphs.setX(f+a._disOriginX),a._graphs.setY(g),a.config.event.enabled&&(a._graphs.sprite.on(e.HOLD,function(b){a._onInduceHandler(b)}),a._graphs.sprite.on(e.DRAG,function(b){a._onInduceHandler(b)}),a._graphs.sprite.on(e.RELEASE,function(b){a._offInduceHandler(b)}))},_trimYAxis:function(){for(var a=this,b=a.dataFrame.yAxis.section[a.dataFrame.yAxis.section.length-1],c=a.dataFrame.yAxis.section,d=[],e=0,f=c.length;f>e;e++){var g=-(c[e]-a._baseNumber)/(b-a._baseNumber)*a._yGraphsHeight;g=isNaN(g)?0:parseInt(g),d[e]={content:c[e],y:g}}a.dataFrame.yAxis.data=d},_getYAxisDisLine:function(){var a=this,b=a._disYAxisTopLine,c=2*b,d=b;return d=b+a._yMaxHeight%a.dataFrame.yAxis.section.length,d=d>c?c:d},_trimXAxis:function(){for(var a=this,b=a.dataFrame.xAxis.org.length,c=a.dataFrame.xAxis.org,d=[],e=0,f=c.length;f>e;e++){var g={content:c[e],x:parseInt(e/(b-1)*a._xGraphsWidth)};d.push(g)}1==b&&(g.x=parseInt(a._xGraphsWidth/2)),a.dataFrame.xAxis.data=d},_getXAxisDisLine:function(){var a=this,b=a._disXAxisLine,c=2*b,d=b;return d=b+a._xMaxWidth%a.dataFrame.xAxis.org.length,d=d>c?c:d,d=isNaN(d)?0:d},_trimGraphs:function(){for(var a=this,b=a.dataFrame.yAxis.section[a.dataFrame.yAxis.section.length-1],c=a.dataFrame.xAxis.org.length,d=a.dataFrame.yAxis.org,e=[],f=0,g=d.length;g>f;f++)for(var h=0,i=d[f].length;i>h;h++){e[f]?"":e[f]=[];var j=-(d[f][h]-a._baseNumber)/(b-a._baseNumber)*a._yGraphsHeight;j=isNaN(j)?0:j,e[f][h]={value:d[f][h],x:h/(c-1)*a._xGraphsWidth,y:j}}1==c&&e[0]&&e[0][0]&&(e[0][0].x=parseInt(a._xGraphsWidth/2)),a.dataFrame.graphs.data=e},_getGraphsDisX:function(){var a=this;return a._xGraphsWidth/(a.dataFrame.xAxis.org.length-1)},_drawEnd:function(){var a=this;a.stageBg.addChild(a._back.sprite),a.core.addChild(a._xAxis.sprite),a.core.addChild(a._graphs.sprite),a.core.addChild(a._yAxis.sprite),a.stageTip.addChild(a._tips.sprite)},_onInduceHandler:function(a){if(a.info){for(var b=this,d=b._graphs.line.strokeStyle.overs,e=b._tips.opt.context,f=b._tips.opt.disTop,g=(a.info.iGroup,a.info.iNode),h=[],i=b.dataFrame.graphs.data,j=0,k=i.length;k>j;j++){if(!h[j]){h[j]=[];var l={content:e.prefix.values[j],bold:e.bolds[j],fontSize:e.fontSizes[j],fillStyle:e.fillStyles[j],sign:{enabled:1,trim:1,fillStyle:d[j]}};h[j].push(l)}var l={content:c.numAddSymbol(i[j][g].value),bold:e.bolds[j],fontSize:e.fontSizes[j],fillStyle:e.fillStyles[j],y_align:1};h[j].push(l)}var m=(parseInt(a.info.nodeInfo.stageX),parseInt(f),a.target.localToGlobal(a.info.nodeInfo,b.core)),n={w:b.width,h:b.height};n.tip={x:m.x,y:m.y,data:h};var o=b._graphs.getY()-f;n.line={x:m.x,y:parseInt(b._graphs.getY()),yEnd:-o};for(var h=[],i=a.info.nodesInfoList,j=0,k=i.length;k>j;j++){i[j].y=a.target.context.height-Math.abs(i[j].y);var p=a.target.localToGlobal(i[j],b.core),l={x:parseInt(p.x),y:parseInt(p.y),fillStyle:d[j]};h.push(l)}n.nodes={data:h},b._tips.remove(),b._tips.draw(n)}},_offInduceHandler:function(){var a=this;a._tips&&a._tips.remove()}},l},{requires:["dvix/","dvix/utils/tools","dvix/utils/datasection","dvix/event/eventtype","dvix/components/xaxis/xAxis","dvix/components/yaxis/yAxis","dvix/components/back/Back","dvix/components/line/Graphs","dvix/components/tips/Tips"]});