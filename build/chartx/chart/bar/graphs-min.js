define("chartx/chart/bar/graphs",["canvax/index","canvax/shape/Rect","canvax/animation/Tween","chartx/utils/tools"],function(a,b,c,d){var e=function(a,b){this.w=0,this.h=0,this.root=b,this.pos={x:0,y:0},this._colors=["#42a8d7","#666666","#6f8cb2","#c77029","#f15f60","#ecb44f","#ae833a","#896149","#4d7fff"],this.bar={width:12,radius:2},this.text={enabled:0,fillStyle:"#999999",fontSize:12,textAlign:"left",format:null},this.eventEnabled=!0,this.sprite=null,this.txtsSp=null,this.yDataSectionLen=0,_.deepExtend(this,a),this.init()};return e.prototype={init:function(){this.sprite=new a.Display.Sprite({id:"graphsEl"}),this.txtsSp=new a.Display.Sprite({id:"txtsSp",context:{visible:!1}})},setX:function(a){this.sprite.context.x=a},setY:function(a){this.sprite.context.y=a},_getColor:function(a,b,c,d,e,f,g){var h=null;if(_.isString(a)&&(h=a),_.isArray(a)){var i=a[d];_.isArray(i)||(i=[i]),h=i[f]}return _.isFunction(a)&&(h=a({iGroup:d,iNode:e,iLay:f,value:g})),h&&""!=h||(h=this._colors[c>1?f+d*b%(c*(d+1)):d]),h},checkBarW:function(a){this.bar.width>=a&&(this.bar.width=a-1>1?a-1:1)},draw:function(c,e){if(_.deepExtend(this,e),0!=c.length){this.data=c;var f=this,g=c.length;_.each(c,function(c,e){var i=c.length;if(0!=i){var j=c[0].length;for(h=0;h<j;h++){var k;if(0==e){k=new a.Display.Sprite({id:"barGroup_"+h}),f.sprite.addChild(k);var l=f.w/j,m=new b({id:"bhr_"+h,context:{x:l*h,y:-f.h,width:l,height:f.h,fillStyle:"#ccc",globalAlpha:0}});k.addChild(m),m.hover(function(a){this.context.globalAlpha=.1},function(a){this.context.globalAlpha=0}),m.iGroup=h,m.iNode=-1,m.iLay=-1,m.on("panstart mouseover mousemove mouseout",function(a){a.tipsInfo=f._getInfoHandler(a),f._fireHandler(a)})}else k=f.sprite.getChildById("barGroup_"+h);for(v=0;v<i;v++){var n=c[v][h];n.iGroup=h,n.iNode=e,n.iLay=v;var o=parseInt(Math.abs(n.y));v>0&&(o-=parseInt(Math.abs(c[v-1][h].y)));var p=f._getColor(f.bar.fillStyle,g,i,e,h,v,n.value),q={x:Math.round(n.x-f.bar.width/2),y:parseInt(n.y),width:parseInt(f.bar.width),height:o,fillStyle:p};if(f.bar.radius){var r=Math.min(f.bar.width/2,o);r=Math.min(r,f.bar.radius),q.radius=[r,r,0,0],v>0&&(q.radius=[r])}var s=new b({context:q});if(k.addChild(s),1==i){var t=n.value;t=_.isFunction(f.text.format)?f.text.format(t):d.numAddSymbol(t);var u=new a.Display.Text(t,{context:{fillStyle:f.text.fillStyle,fontSize:f.text.fontSize,textAlign:f.text.textAlign}});u.context.x=n.x-u.getTextWidth()/2,u.context.y=q.y-u.getTextHeight(),u.context.y+f.h<0&&(u.context.y=-f.h),f.txtsSp.addChild(u)}}if(i>0){var q={x:s.context.x,y:-parseInt(Math.abs(n.y)),width:s.context.width,height:parseInt(Math.abs(n.y)),fillStyle:"#ff0000",globalAlpha:0},m=new b({context:q});k.addChild(m),m.iGroup=h,m.iNode=e,m.iLay=-1,m.on("panstart mouseover mousemove mouseout",function(a){a.tipsInfo=f._getInfoHandler(a),f._fireHandler(a)})}}}}),this.txtsSp.children.length>0&&this.sprite.addChild(this.txtsSp),this.sprite.context.x=this.pos.x,this.sprite.context.y=this.pos.y}},grow:function(){function a(){d=requestAnimationFrame(a),c.update()}var b=this,d=null,e=function(){new c.Tween({h:0}).to({h:b.h},500).onUpdate(function(){b.sprite.context.scaleY=this.h/b.h}).onComplete(function(){b._growEnd(),cancelAnimationFrame(d)}).start();a()};e()},_growEnd:function(){this.text.enabled&&(this.txtsSp.context.visible=!0)},_getInfoHandler:function(a){var b={iGroup:a.target.iGroup,iNode:a.target.iNode,iLay:a.target.iLay,nodesInfoList:this._getNodeInfo(a.target.iGroup,a.target.iNode,a.target.iLay)};return b},_getNodeInfo:function(a,b,c){var d=[],e=this,f=e.data.length;return _.each(e.data,function(c,g){var i,j=c.length;if(0!=j){var k=c[0].length;for(h=0;h<k;h++)if(h==a)for(v=0;v<j;v++)(b==g||-1==b)&&(i=c[v][h],i.fillStyle=e._getColor(e.bar.fillStyle,f,j,g,h,v,i.value),d.push(i))}}),d},_fireHandler:function(a){a.params={iGroup:a.tipsInfo.iGroup,iNode:a.tipsInfo.iNode,iLay:a.tipsInfo.iLay},this.root.fire(a.type,a)}},e});