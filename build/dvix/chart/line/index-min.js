KISSY.add("dvix/chart/line/",function(a,b,c,d,e,f){var g=b.Canvax;window.Canvax=g;var h=function(){this.title="line",this.type=null,this.oneStrSize=null,this.element=null,this.canvax=null,this.width=0,this.height=0,this.data=null,this.dataRange={start:0,to:0},this.fieldList={title:"",index:0},this.barWidth=1,this.spaceWidth=5,this.spaceWidthMin=1,this.xAxis=null,this.yAxis=null,this.back=null,this.graphs={barColor:["#458AE6","#39BCC0","#5BCB8A"],lineColor:"#D6D6D6",sprite:null},this.customPL=function(a){return a},this.init.apply(this,arguments)};return h.prototype={_yBlock:0,_yOverDiff:0,init:function(a){var b=this;b.element=a,b.width=parseInt(a.width()),b.height=parseInt(a.height()),b.canvax=new g({el:b.element}),b.stage=new g.Display.Stage({id:"core",context:{x:.5,y:.5}}),b.stageBG=new g.Display.Stage({id:"bg",context:{x:.5,y:.5}}),b.oneStrSize=c.probOneStrSize()},draw:function(a,b){var c=this;c._config(a,b),c._initData(),c._startDraw(),c._drawEnd()},_config:function(a,b){var c=this;c.data=a;for(var g=0,h=a[0].length;h>g;g++)c.fieldList[a[0][g]]={index:c._getIndexForField(a[0][g],a[0])};c.xAxis=new d(b.xAxis),c.yAxis=new e(b.yAxis),c.back=new f(b.back)},_getIndexForField:function(a,b){for(var c=0,d=b.length;d>c;c++)if(a===b[c])return c},_initData:function(){},_startDraw:function(){var a,b=this,c=this.height-b.xAxis.h;b.yAxis.draw(),b.yAxis.setY(c),a=b.yAxis.w,b.xAxis.draw({w:b.width-b.yAxis.w}),b.xAxis.setX(a),b.xAxis.setY(c),b.back.draw({w:b.width-b.yAxis.w,h:c-10,xAxis:{data:[{y:0},{y:-100},{y:-200},{y:-300},{y:-400},{y:-500},{y:-600},{y:-700}]},yAxis:{h:300,data:[{x:100},{x:200},{x:300},{x:400},{x:500},{x:600},{x:700}]}}),b.back.setX(a),b.back.setY(c)},_drawEnd:function(){var a=this;a.stageBG.addChild(a.back.sprite),a.stage.addChild(a.yAxis.sprite),a.stage.addChild(a.xAxis.sprite),a.canvax.addChild(a.stageBG),a.canvax.addChild(a.stage)},_graphsLayout:function(){var a=this,b=a.yAxis.sprite.context;a.graphs.sprite=new g.Display.Sprite({context:{x:b.width,y:b.y,width:a.width-b.width,height:b.height}})},_calculateDataRange:function(){var a=this,b=a.graphs.sprite.context,c=a.data.length-1;a.dataRange.start=1,a.dataRange.to=(a.barWidth+a.spaceWidthMin)*c>b.width?parseInt(b.width/(a.barWidth+a.spaceWidthMin)):c;var d=(b.width-a.barWidth)/(a.dataRange.to-a.dataRange.start);a.spaceWidth=d-a.barWidth,a._yBlock=parseInt(b.height/(a.yAxis.data.length-1)),a._yOverDiff=b.height-a._yBlock*(a.yAxis.data.length-1)},_graphsDraw:function(){for(var b=this,c=b.data,d=b.yAxis,e=(b.xAxis,b.graphs),f=e.sprite.context,h=0,i=d.data.length-1;i>h;h++){var j=-b.oneStrSize.en.width+2,k=Math.round(h*b._yBlock)+b._yOverDiff;e.sprite.addChild(new g.Shapes.Line({context:{xStart:j,yStart:k,xEnd:j+f.width+b.oneStrSize.en.width-2,yEnd:k,lineType:"dashed",lineWidth:1,strokeStyle:e.lineColor}}))}e.sprite.addChild(new g.Shapes.Line({id:"line-left",context:{xStart:0,yStart:-f.y,xEnd:0,yEnd:f.height,lineWidth:1,strokeStyle:e.lineColor}})),e.sprite.addChild(new g.Shapes.Line({id:"line-bottom",context:{xStart:0,yStart:f.height,xEnd:b.width-f.x,yEnd:f.height,lineWidth:1,strokeStyle:e.lineColor}}));var l=b.dataRange,m=0,n=0;a.each(d.data,function(a){m=Math.max(m,a),n=Math.min(n,a)});var o=b.barWidth+b.spaceWidth;a.each(d.fields,function(h){for(var i=[],j=l.start;j<=l.to;j++){var k=j-l.start,p=Math.round(k*o),q=f.height-Math.round((f.height-b._yOverDiff)*(c[j][b.fieldList[h].index]/(m-n)));i.push([p,q])}b.xAxis.getxAxisPoints(i,o);var r=(d.data.length-1-a.indexOf(0,d.data))*b._yBlock-e.sprite.context.height;e.sprite.addChild(new g.Shapes.BrokenLine({context:{pointList:b.customPL(i),strokeStyle:"red",lineWidth:1,x:0,y:r}}))})}},h},{requires:["dvix/","dvix/utils/tools","dvix/components/xaxis/xAxis","dvix/components/yaxis/yAxis","dvix/components/back/Back"]});