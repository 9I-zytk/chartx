KISSY.add("visualization/chart/brokenline/",function(a,b,c,d,e){var f=function(){this.title="brokenline",this.type=null,this.oneStrSize=null,this.element=null,this.canvax=null,this.width=0,this.height=0,this.data=null,this.dataRange={start:0,to:0},this.fieldList={title:"",index:0},this.barWidth=1,this.spaceWidth=5,this.spaceWidthMin=1,this.xAxis=null,this.yAxis=null,this.graphs={barColor:["#458AE6","#39BCC0","#5BCB8A"],lineColor:"#D6D6D6",sprite:null},this.customPL=function(a){return a},this.init.apply(this,arguments)};return f.prototype={_yBlock:0,_yOverDiff:0,init:function(a){var c=this;c.element=a,c.width=parseInt(a.width()),c.height=parseInt(a.height()),c.canvax=new e({el:c.element}),c.stage=new e.Display.Stage({context:{width:c.width,height:c.height}}),c.oneStrSize=b.probOneStrSize()},draw:function(a,b){var c=this;c._config(a,b),c._initData(),c._initLayout(),c._calculateDataRange(),c._startDraw(),c._drawEnd()},_config:function(b,e){var f=this;f.data=b;for(var g=0,h=b[0].length;h>g;g++)f.fieldList[b[0][g]]={index:f._getIndexForField(b[0][g],b[0])};e.xAxis&&(f.xAxis=new c(f,e.xAxis),e.xAxis=null,delete e.xAxis),e.yAxis&&(f.yAxis=new d(f,e.yAxis),e.yAxis=null,delete e.yAxis),e&&a.mix(f,e,void 0,void 0,!0)},_getIndexForField:function(a,b){for(var c=0,d=b.length;d>c;c++)if(a===b[c])return c},_initData:function(){var a=this;a.xAxis.getxAxisData(),a.yAxis.getyAxisData()},_initLayout:function(){var a=this;a.yMarginTop=Math.round(a.oneStrSize.en.height/2),a.yAxis.yAxisLayout(),a.xAxis.xAxisLayout(),a._graphsLayout()},_startDraw:function(){var a=this;a._graphsDraw(),a.yAxis.yAxisDraw(),a.xAxis.xAxisDraw()},_drawEnd:function(){var a=this;a.stage.addChild(a.xAxis.sprite),a.stage.addChild(a.yAxis.sprite),a.stage.addChild(a.graphs.sprite),a.canvax.addChild(a.stage)},_graphsLayout:function(){var a=this,b=a.yAxis.sprite.context;a.graphs.sprite=new e.Display.Sprite({context:{x:b.width,y:b.y,width:a.width-b.width,height:b.height}})},_calculateDataRange:function(){var a=this,b=a.graphs.sprite.context,c=a.data.length-1;a.dataRange.start=1,a.dataRange.to=(a.barWidth+a.spaceWidthMin)*c>b.width?parseInt(b.width/(a.barWidth+a.spaceWidthMin)):c;var d=(b.width-a.barWidth)/(a.dataRange.to-a.dataRange.start);a.spaceWidth=d-a.barWidth,a._yBlock=parseInt(b.height/(a.yAxis.data.length-1)),a._yOverDiff=b.height-a._yBlock*(a.yAxis.data.length-1)},_graphsDraw:function(){for(var b=this,c=b.data,d=b.yAxis,f=(b.xAxis,b.graphs),g=f.sprite.context,h=0,i=d.data.length-1;i>h;h++){var j=-b.oneStrSize.en.width+2,k=Math.round(h*b._yBlock)+b._yOverDiff;f.sprite.addChild(new e.Shapes.Line({context:{xStart:j,yStart:k,xEnd:j+g.width+b.oneStrSize.en.width-2,yEnd:k,lineType:"dashed",lineWidth:1,strokeStyle:f.lineColor}}))}f.sprite.addChild(new e.Shapes.Line({id:"line-left",context:{xStart:0,yStart:-g.y,xEnd:0,yEnd:g.height,lineWidth:1,strokeStyle:f.lineColor}})),f.sprite.addChild(new e.Shapes.Line({id:"line-bottom",context:{xStart:0,yStart:g.height,xEnd:b.width-g.x,yEnd:g.height,lineWidth:1,strokeStyle:f.lineColor}}));var l=b.dataRange,m=0,n=0;a.each(d.data,function(a){m=Math.max(m,a),n=Math.min(n,a)});var o=b.barWidth+b.spaceWidth;a.each(d.fields,function(h){for(var i=[],j=l.start;j<=l.to;j++){var k=j-l.start,p=Math.round(k*o),q=g.height-Math.round((g.height-b._yOverDiff)*(c[j][b.fieldList[h].index]/(m-n)));i.push([p,q])}b.xAxis.getxAxisPoints(i,o);var r=(d.data.length-1-a.indexOf(0,d.data))*b._yBlock-f.sprite.context.height;f.sprite.addChild(new e.Shapes.BrokenLine({context:{pointList:b.customPL(i),strokeStyle:"red",lineWidth:1,x:0,y:r}}))})}},f},{requires:["visualization/utils/tools","visualization/components/xaxis/xAxis","visualization/components/yaxis/yAxis","canvax/"]});