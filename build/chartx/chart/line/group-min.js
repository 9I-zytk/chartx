define("chartx/chart/line/group",["canvax/index","canvax/shape/BrokenLine","canvax/shape/Circle","canvax/shape/Path","chartx/utils/tools","chartx/utils/colorformat","canvax/animation/Tween","chartx/chart/theme"],function(a,b,c,d,e,f,g,h){window.Canvax=a;var i=function(a,b,c,d,e,f,g,i){this.field=a,this._groupInd=b,this._nodeInd=-1,this._yAxis=f,this.sort=e,this.ctx=d,this.w=i,this.h=g,this.y=0,this.colors=h.colors,this.line={enabled:1,strokeStyle:this.colors[this._groupInd],lineWidth:2,lineType:"solid",smooth:!0},this.node={enabled:1,corner:!1,r:2,fillStyle:"#ffffff",strokeStyle:null,lineWidth:3},this.fill={fillStyle:null,alpha:.05},this.dataOrg=[],this.data=[],this.sprite=null,this._pointList=[],this._currPointList=[],this._bline=null,this.init(c)};return i.prototype={init:function(b){_.deepExtend(this,b),!this.node.strokeStyle&&(this.node.strokeStyle=this._getLineStrokeStyle()),!this.fill.fillStyle&&(this.fill.fillStyle=this._getLineStrokeStyle()),this.sprite=new a.Display.Sprite},draw:function(a){_.deepExtend(this,a),this._widget()},update:function(a){_.deepExtend(this,a),this._pointList=this._getPointList(this.data),this._grow()},destroy:function(){this.sprite.remove()},_getColor:function(a){var b=this._getProp(a);return b&&""!=b||(b=this.colors[this._groupInd]),b},_getProp:function(a){return _.isArray(a)?a[this._groupInd]:_.isFunction(a)?a({iGroup:this._groupInd,iNode:this._nodeInd,field:this.field}):a},_getLineStrokeStyle:function(){return this.__lineStyleStyle?this.__lineStyleStyle:(this.__lineStyleStyle=this._getColor(this.line.strokeStyle),this.__lineStyleStyle)},getNodeInfoAt:function(a){var b=this;b._nodeInd=a;var c=_.clone(b.dataOrg[a]);return c&&null!=c.value&&void 0!=c.value&&""!==c.value?(c.r=b._getProp(b.node.r),c.fillStyle=b._getProp(b.node.fillStyle)||"#ffffff",c.strokeStyle=b._getProp(b.node.strokeStyle)||b._getLineStrokeStyle(),c.color=b._getProp(b.node.strokeStyle)||b._getLineStrokeStyle(),c.lineWidth=b._getProp(b.node.lineWidth)||2,c.alpha=b._getProp(b.fill.alpha),c.field=b.field,c._groupInd=b._groupInd,c):null},resetData:function(a){var b=this;b._pointList=this._getPointList(a.data);var c=b._pointList.length,d=b._currPointList.length;if(d>c){for(var e=c,f=d;f>e;e++)b._circles.removeChildAt(e),f--,e--;b._currPointList.length=c}if(c>d){diffLen=c-d;for(var e=0;e<diffLen;e++)b._currPointList.push(_.clone(b._currPointList[d-1]))}b._circles&&b._circles.removeAllChildren(),b._createNodes(),b._grow()},_grow:function(a){function b(){d=requestAnimationFrame(b),g.update()}var c=this,d=null;if(0!=c._currPointList.length){var e=function(){var e=c._getPointPosStr(c._currPointList),f=c._getPointPosStr(c._pointList);new g.Tween(e).to(f,1500).easing(g.Easing.Quintic.Out).onUpdate(function(){for(var a in this){var b=parseInt(a.split("_")[2]),d=parseInt(a.split("_")[1]);c._currPointList[b]&&(c._currPointList[b][d]=this[a])}c._bline.context.pointList=_.clone(c._currPointList),c._fill.context.path=c._fillLine(c._bline),c._circles&&_.each(c._circles.children,function(a,b){var d=parseInt(a.id.split("_")[1]);a.context.y=c._currPointList[d][1],a.context.x=c._currPointList[d][0]})}).onComplete(function(){cancelAnimationFrame(d),a&&a(c)}).start();b()};e()}},_getPointPosStr:function(a){var b={};return _.each(a,function(a,c){b["p_1_"+c]=a[1],b["p_0_"+c]=a[0]}),b},_isNotNum:function(a){return isNaN(a)||null===a||""===a},_filterEmptyValue:function(a){for(var b=0,c=a.length;c>b&&this._isNotNum(a[b].value);b++)a.shift(),c--,b--;for(var b=a.length-1;b>0&&this._isNotNum(a[b].value);b--)a.pop()},_getPointList:function(a){var b=this;b.dataOrg=_.clone(a),b._filterEmptyValue(a);for(var c=[],d=0,e=a.length;e>d;d++){var f=a[d];c.push([f.x,f.y])}return c},_widget:function(){var a=this;if(a._pointList=this._getPointList(a.data),0!=a._pointList.length){for(var c=[],e=0,g=a.data.length;g>e;e++){var h=a.data[e],i=0;"right"==a._yAxis.place&&(i=g-1),c.push([h.x,a.data[i].y])}a._currPointList=c;var j=new b({id:"brokenline_"+a._groupInd,context:{pointList:c,strokeStyle:a._getLineStrokeStyle(),lineWidth:a.line.lineWidth,y:a.y,smooth:a.line.smooth,lineType:a._getProp(a.line.lineType),smoothFilter:function(a){a[1]>0&&(a[1]=0)}}});this.line.enabled||(j.context.visible=!1),a.sprite.addChild(j),a._bline=j;var k=null;if(_.isArray(a.fill.alpha)){a.fill.alpha.length=2,void 0==a.fill.alpha[0]&&(a.fill.alpha[0]=0),void 0==a.fill.alpha[1]&&(a.fill.alpha[1]=0);var l=_.min(j.context.pointList,function(a){return a[1]});k=a.ctx.createLinearGradient(l[0],l[1],l[0],0);var m=f.colorRgb(a._getColor(a.fill.fillStyle)),n=m.replace(")",", "+a._getProp(a.fill.alpha[0])+")").replace("RGB","RGBA");k.addColorStop(0,n);var o=m.replace(")",", "+a.fill.alpha[1]+")").replace("RGB","RGBA");k.addColorStop(1,o)}var p=new d({context:{path:a._fillLine(j),fillStyle:k||a._getColor(a.fill.fillStyle),globalAlpha:k?1:a.fill.alpha}});a.sprite.addChild(p),a._fill=p,a._createNodes()}},_createNodes:function(){var b=this,d=b._currPointList;if((b.node.enabled||1==d.length)&&b.line.lineWidth){this._circles=new a.Display.Sprite({id:"circles"}),this.sprite.addChild(this._circles);for(var e=0,f=d.length;f>e;e++){b._nodeInd=e;var g=b._getProp(b.node.strokeStyle)||b._getLineStrokeStyle(),h={x:b._currPointList[e][0],y:b._currPointList[e][1],r:b._getProp(b.node.r),fillStyle:1==d.length?g:b._getProp(b.node.fillStyle)||"#ffffff",strokeStyle:g,lineWidth:b._getProp(b.node.lineWidth)||2},i=0;"right"==b._yAxis.place&&(i=f-1),e==i&&(h.fillStyle=h.strokeStyle,h.r++);var j=new c({id:"circle_"+e,context:h});if(b.node.corner){var k=b._pointList[e][1],l=b._pointList[e-1],m=b._pointList[e+1];l&&m&&k==l[1]&&k==m[1]&&(j.context.visible=!1)}b._circles.addChild(j)}b._nodeInd=-1}},_fillLine:function(a){var b=_.clone(a.context.pointList),c=0;return"desc"==this.sort&&(c=-this.h),b.push([b[b.length-1][0],c],[b[0][0],c],[b[0][0],b[0][1]]),e.getPath(b)}},i});