define("chartx/chart/map/tips",["canvax/index","canvax/shape/Circle","chartx/components/tips/tip","canvax/shape/Polygon","canvax/animation/Tween"],function(a,b,c,d,e){var f=function(a,b,c){this.sprite=null,this._triangle=null,this._tip=null,this.prefix=[],this._mapScale=1,this.cPointStyle="white",this._nearestPoint=null,this._thirdPoint=null,this._tween=null,this.init(a,b,c)};return f.prototype={init:function(b,d,e){_.deepExtend(this,b),this.sprite=new a.Display.Sprite({id:"map-tips"}),b=_.deepExtend({_getDefaultContent:function(a){var b="<table>",c=this;return b+="<tr style='color:#999'><td colspan='2'>"+a.area.value+"</td></tr>",_.each(a.nodesInfoList,function(a,d){b+="<tr style='color:#999'>";var e=c.prefix[d];e||(e=a.field),b+="<td>"+e+"\uff1a</td>",b+="<td>"+a.value+"</td></tr>"}),b+="</table>"}},b),this._tip=new c(_.deepExtend({alpha:1,fillStyle:"#ffffff",strokeStyle:"#b0b0b0"},b),e)},show:function(a){this.sprite.addChild(this._tip.sprite),this._tip.show(a),this._weight(a),this._tip.sprite.toFront(),this.sprite.toFront(),this._triangle.context.globalAlpha=.7},move:function(a){this._tip.move(a)},hide:function(a){this._tip.hide(a),this._cPoint.remove(),this._triangle.context.globalAlpha=0},_weight:function(a){function c(){o=requestAnimationFrame(c),e.update()}var f=this._tip.backR,g=[a.target.mapData.cp[0]*this._mapScale,a.target.mapData.cp[1]*this._mapScale];this._cPoint=new b({context:{x:g[0],y:g[1],r:3,fillStyle:this.cPointStyle}}),this.sprite.addChild(this._cPoint);var h="left";g[0]<560*this._mapScale/2&&(h="right");var i=80,j=[g[0]+Math.cos(-Math.PI*("left"==h?3:2)/5)*i,g[1]+Math.sin(-Math.PI*("left"==h?3:2)/5)*i];j[1]<0&&(j[1]=2);var k=this._tip.dW,l=this._tip.dH,m=[j[0]+("left"==h?-k:k),j[1]+l];if(this._thirdPoint&&this._nearestPoint){var n=this,o=null;n._tween&&n._tween.stop();var p=function(){n._tween=new e.Tween({n0:n._nearestPoint[0],n1:n._nearestPoint[1]}).to({n0:j[0],n1:j[1]},500).easing(e.Easing.Exponential.Out).onUpdate(function(){n._nearestPoint[0]=this.n0,n._nearestPoint[1]=this.n1,n._thirdPoint[0]=this.n0+("left"==h?-k:k),n._thirdPoint[1]=this.n1+l;var a=n._nearestPoint,b=n._thirdPoint;n._triangle.context.pointList=[g,[a[0],a[1]+f],[b[0]+("left"==h?f:-f),b[1]]];var c=n.sprite.localToGlobal({x:"left"==h?n._thirdPoint[0]:n._nearestPoint[0],y:n._nearestPoint[1]});n._tip.setPosition({pos:c})}).onComplete(function(){cancelAnimationFrame(o),n._tween=null}).start(),c()};p()}else{var q=j,r=m;this._triangle=new d({context:{pointList:[g,[q[0],q[1]+f],[r[0]+("left"==h?f:-f),r[1]]],fillStyle:"white",globalAlpha:.7}}),this.sprite.addChild(this._triangle),this._thirdPoint=m,this._nearestPoint=j;var s=this.sprite.localToGlobal({x:"left"==h?m[0]:j[0],y:j[1]});this._tip.setPosition({pos:s})}}},f});