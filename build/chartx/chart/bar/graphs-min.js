define("chartx/chart/bar/graphs",["canvax/index","canvax/shape/Rect","canvax/animation/Tween","chartx/utils/tools","chartx/chart/theme"],function(a,b,c,d,e){var f=function(a,b){this.w=0,this.h=0,this.root=b,this._yAxisFieldsMap={},this._setyAxisFieldsMap(),this.pos={x:0,y:0},this._colors=e.colors,this.bar={width:20,radius:4},this.text={enabled:0,fillStyle:"#999",fontSize:12,format:null},this.sort=null,this.eventEnabled=!0,this.sprite=null,this.txtsSp=null,this.yDataSectionLen=0,_.deepExtend(this,a),this.init()};return f.prototype={init:function(){this.sprite=new a.Display.Sprite({id:"graphsEl"}),this.txtsSp=new a.Display.Sprite({id:"txtsSp",context:{visible:!1}})},setX:function(a){this.sprite.context.x=a},setY:function(a){this.sprite.context.y=a},_setyAxisFieldsMap:function(){var a=this;_.each(_.flatten(this.root.dataFrame.yAxis.field),function(b,c){a._yAxisFieldsMap[b]=c})},_getColor:function(a,b,c,d,e,f,g,h){var i=null;return _.isString(a)&&(i=a),_.isArray(a)&&(i=_.flatten(a)[this._yAxisFieldsMap[h]]),_.isFunction(a)&&(i=a({iGroup:d,iNode:e,iLay:f,field:h,value:g})),i&&""!=i||(i=this._colors[this._yAxisFieldsMap[h]]),i},checkBarW:function(a){this.bar.width>=a&&(this.bar.width=a-1>1?a-1:1)},draw:function(c,e){if(_.deepExtend(this,e),0!=c.length){this.data=c;var f=this,g=c.length;_.each(c,function(c,e){var i=c.length;if(0!=i){var j=c[0].length;for(h=0;h<j;h++){var k;if(0==e){k=new a.Display.Sprite({id:"barGroup_"+h}),f.sprite.addChild(k);var l=f.w/j,m=new b({id:"bhr_"+h,pointChkPriority:!1,context:{x:l*h,y:-f.h,width:l,height:f.h,fillStyle:"#ccc",globalAlpha:0}});k.addChild(m),m.hover(function(a){this.context.globalAlpha=.1},function(a){this.context.globalAlpha=0}),m.iGroup=h,m.iNode=-1,m.iLay=-1,m.on("panstart mouseover mousemove mouseout click",function(a){a.eventInfo=f._getInfoHandler(this,a)})}else k=f.sprite.getChildById("barGroup_"+h);for(v=0;v<i;v++){var n=c[v][h];n.iGroup=h,n.iNode=e,n.iLay=v;var o=parseInt(Math.abs(n.y));v>0&&(o-=parseInt(Math.abs(c[v-1][h].y)));var p=parseInt(n.y),q=f._getColor(f.bar.fillStyle,g,i,e,h,v,n.value,n.field),r={x:Math.round(n.x-f.bar.width/2),y:p,width:parseInt(f.bar.width),height:o,fillStyle:q};if(f.bar.radius&&v==i-1){var s=Math.min(f.bar.width/2,o);s=Math.min(s,f.bar.radius),r.radius=[s,s,0,0]}var t=new b({context:r});if(k.addChild(t),t.iGroup=h,t.iNode=e,t.iLay=v,t.on("panstart mouseover mousemove mouseout click",function(a){a.eventInfo=f._getInfoHandler(this,a),"mouseover"==a.type&&(this.parent.getChildById("bhr_"+this.iGroup).context.globalAlpha=.1),"mouseout"==a.type&&(this.parent.getChildById("bhr_"+this.iGroup).context.globalAlpha=0)}),1==i){var u=n.value;u=_.isFunction(f.text.format)?f.text.format(u):d.numAddSymbol(u);var w={fillStyle:f.text.fillStyle,fontSize:f.text.fontSize},x=new a.Display.Text(u,w);x.context.x=n.x-x.getTextWidth()/2,x.context.y=r.y-x.getTextHeight(),x.context.y+f.h<0&&(x.context.y=-f.h),f.txtsSp.addChild(x)}}}}}),this.txtsSp.children.length>0&&this.sprite.addChild(this.txtsSp),this.sprite.context.x=this.pos.x,this.sprite.context.y=this.pos.y,this.sort&&"desc"==this.sort&&(this.sprite.context.y-=this.h)}},grow:function(a){function b(){e=requestAnimationFrame(b),c.update()}var d=this,e=null,f=1;this.sort&&"desc"==this.sort&&(f=-1);var g=function(){new c.Tween({h:0}).to({h:d.h},500).onUpdate(function(){d.sprite.context.scaleY=f*this.h/d.h}).onComplete(function(){d._growEnd(),cancelAnimationFrame(e),a&&a(d)}).start();b()};g()},_growEnd:function(){this.text.enabled&&(this.txtsSp.context.visible=!0)},_getInfoHandler:function(a){var b={iGroup:a.iGroup,iNode:a.iNode,iLay:a.iLay,nodesInfoList:this._getNodeInfo(a.iGroup,a.iNode,a.iLay)};return b},_getNodeInfo:function(a,b,c){var d=[],e=this,f=e.data.length;return _.each(e.data,function(g,i){var j,k=g.length;if(0!=k){var l=g[0].length;for(h=0;h<l;h++)if(h==a)for(v=0;v<k;v++)b!=i&&-1!=b||c!=v&&-1!=c||(j=g[v][h],j.fillStyle=e._getColor(e.bar.fillStyle,f,k,i,h,v,j.value,j.field),d.push(j))}}),d}},f});