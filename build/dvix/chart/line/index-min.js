KISSY.add("dvix/chart/line/",function(a,b,c,d,e,f,g,h,i,j){var k=b.Canvax;window.Canvax=k;var l=function(){this.version="0.1",this.type="line",this.canvax=null,this.element=null,this.width=0,this.height=0,this.config={mode:1,event:{enabled:1}},this.dataFrame={org:[],data:[],yAxis:{fields:[],org:[],section:[],data:[]},xAxis:{field:"",org:[],data:[]},graphs:{data:[],disX:0}},this._chartWidth=0,this._chartHeight=0,this._disX=0,this._disY=6,this._disYAndO=6,this._disXAxisLine=6,this._disYAxisTopLine=6,this._disOriginX=0,this._yMaxHeight=0,this._yGraphsHeight=0,this._xMaxWidth=0,this._xGraphsWidth=0,this._baseNumber=0,this._xAxis=null,this._yAxis=null,this._back=null,this._graphs=null,this._tips=null,this.customPL=function(a){return a},this.init.apply(this,arguments)};return l.prototype={init:function(a){var b=this;b.element=a,b.width=parseInt(a.width()),b.height=parseInt(a.height()),b.canvax=new k({el:b.element}),b.stageTip=new k.Display.Stage({id:"tip",context:{x:.5,y:.5}}),b.stage=new k.Display.Stage({id:"core",context:{x:.5,y:.5}}),b.stageBg=new k.Display.Stage({id:"bg",context:{x:.5,y:.5}})},draw:function(a,b){var c=this;c._initConfig(a,b),c._initModule(b),c._initData(),c._startDraw(),c._drawEnd()},_initConfig:function(a,b){var c=this;if(c.dataFrame.org=a,b){c.config.mode=b.mode||c.config.mode,c._disXAxisLine=b.disXAxisLine||0==b.disXAxisLine?b.disXAxisLine:c._disXAxisLine,c._disYAxisTopLine=b.disYAxisTopLine||0==b.disYAxisTopLine?b.disYAxisTopLine:c._disYAxisTopLine,c._disYAndO=b.disYAndO||0==b.disYAndO?b.disYAndO:c._disYAndO;var d=b.event;d&&(c.config.event.enabled=0==d.enabled?0:c.config.event.enabled);var e=b.yAxis;e&&(c.dataFrame.yAxis.fields=e.fields||c.dataFrame.yAxis.fields);var f=b.xAxis;f&&(c.dataFrame.xAxis.field=f.field||c.dataFrame.xAxis.field)}},_initModule:function(a){var b=this;b._xAxis=new f(a.xAxis),b._yAxis=new g(a.yAxis),b._back=new h(a.back),b._graphs=new i(a.graphs),b._tips=new j(a.tips)},_initData:function(){for(var a=this,b=[],c=a.dataFrame.org,d=0,e=c[0].length;e>d;d++){var f={};f.field=c[0][d],f.index=d,f.data=[],b.push(f)}for(var d=1,e=c.length;e>d;d++)for(var g=0,h=c[d].length;h>g;g++)b[g].data.push(c[d][g]);a.dataFrame.data=b;for(var c=a.dataFrame.data,d=0,e=c.length;e>d;d++){var f=c[d];if(a.dataFrame.xAxis.field)if(f.field==a.dataFrame.xAxis.field&&(a.dataFrame.xAxis.org=f.data),0==a.dataFrame.yAxis.fields.length)f.field!=a.dataFrame.xAxis.field&&a.dataFrame.yAxis.org.push(f.data);else for(var g=0,h=a.dataFrame.yAxis.fields.length;h>g;g++)f.field==a.dataFrame.yAxis.fields[g]&&(a.dataFrame.yAxis.org[g]=f.data);else if(0==d&&(a.dataFrame.xAxis.org=f.data),0==a.dataFrame.yAxis.fields.length)0!=d&&a.dataFrame.yAxis.org.push(f.data);else for(var g=0,h=a.dataFrame.yAxis.fields.length;h>g;g++)f.field==a.dataFrame.yAxis.fields[g]&&(a.dataFrame.yAxis.org[g]=f.data)}},_startDraw:function(){var a=this,b=c.getChildsArr(a.dataFrame.yAxis.org);a.dataFrame.yAxis.section=d.section(b),a._baseNumber=a.dataFrame.yAxis.section[0],1==b.length&&(a.dataFrame.yAxis.section[0]=2*b[0],a._baseNumber=0),a._chartWidth=a.width-2*a._disX,a._chartHeight=a.height-2*a._disY,a._yMaxHeight=a._chartHeight-a._xAxis.h,a._yGraphsHeight=a._yMaxHeight-a._getYAxisDisLine(),a._trimYAxis();var f=a._disX,g=this.height-a._xAxis.h-a._disY;a._yAxis.draw({data:a.dataFrame.yAxis.data}),a._yAxis.setX(f),a._yAxis.setY(g);var h=a._yAxis.w;2==a.config.mode&&(h=0,a._disYAndO=0),f=a._disX+h+a._disYAndO,a._xMaxWidth=a._chartWidth-h-a._disYAndO,a._xGraphsWidth=a._xMaxWidth-a._getXAxisDisLine(),a._disOriginX=parseInt((a._xMaxWidth-a._xGraphsWidth)/2),a._trimXAxis(),a._xAxis.draw({w:a._xMaxWidth,max:{left:-(h+a._disYAndO+a._disOriginX),right:a._xGraphsWidth+a._disOriginX},data:a.dataFrame.xAxis.data}),a._xAxis.setX(f+a._disOriginX),a._xAxis.setY(g),a._back.draw({w:a._chartWidth-h-a._disYAndO,h:g,xAxis:{data:a.dataFrame.yAxis.data}}),a._back.setX(f),a._back.setY(g),a.dataFrame.graphs.disX=a._getGraphsDisX(),a._trimGraphs(),a._graphs.draw({w:a._xGraphsWidth,h:a._yGraphsHeight,data:a.dataFrame.graphs.data,disX:a.dataFrame.graphs.disX}),a._graphs.setX(f+a._disOriginX),a._graphs.setY(g),a.config.event.enabled&&(a._graphs.sprite.on(e.HOLD,function(b){a._onInduceHandler(b)}),a._graphs.sprite.on(e.DRAG,function(b){a._onInduceHandler(b)}),a._graphs.sprite.on(e.RELEASE,function(b){a._offInduceHandler(b)}))},_trimYAxis:function(){for(var a=this,b=a.dataFrame.yAxis.section[a.dataFrame.yAxis.section.length-1],c=a.dataFrame.yAxis.section,d=[],e=0,f=c.length;f>e;e++){var g=-(c[e]-a._baseNumber)/(b-a._baseNumber)*a._yGraphsHeight;g=isNaN(g)?0:parseInt(g),d[e]={content:c[e],y:g}}a.dataFrame.yAxis.data=d},_getYAxisDisLine:function(){var a=this,b=a._disYAxisTopLine,c=2*b,d=b;return d=b+a._yMaxHeight%a.dataFrame.yAxis.section.length,d=d>c?c:d},_trimXAxis:function(){for(var a=this,b=a.dataFrame.xAxis.org.length,c=a.dataFrame.xAxis.org,d=[],e=0,f=c.length;f>e;e++){var g={content:c[e],x:parseInt(e/(b-1)*a._xGraphsWidth)};d.push(g)}1==b&&(g.x=parseInt(a._xGraphsWidth/2)),a.dataFrame.xAxis.data=d},_getXAxisDisLine:function(){var a=this,b=a._disXAxisLine,c=2*b,d=b;return d=b+a._xMaxWidth%a.dataFrame.xAxis.org.length,d=d>c?c:d,d=isNaN(d)?0:d},_trimGraphs:function(){for(var a=this,b=a.dataFrame.yAxis.section[a.dataFrame.yAxis.section.length-1],c=a.dataFrame.xAxis.org.length,d=a.dataFrame.yAxis.org,e=[],f=0,g=d.length;g>f;f++)for(var h=0,i=d[f].length;i>h;h++){e[f]?"":e[f]=[];var j=-(d[f][h]-a._baseNumber)/(b-a._baseNumber)*a._yGraphsHeight;j=isNaN(j)?0:j,e[f][h]={value:d[f][h],x:h/(c-1)*a._xGraphsWidth,y:j}}1==c&&e[0]&&e[0][0]&&(e[0][0].x=parseInt(a._xGraphsWidth/2)),a.dataFrame.graphs.data=e},_getGraphsDisX:function(){var a=this;return a._xGraphsWidth/(a.dataFrame.xAxis.org.length-1)},_drawEnd:function(){var a=this;a.stageBg.addChild(a._back.sprite),a.stage.addChild(a._xAxis.sprite),a.stage.addChild(a._graphs.sprite),a.stage.addChild(a._yAxis.sprite),a.stageTip.addChild(a._tips.sprite),a.canvax.addChild(a.stageBg),a.canvax.addChild(a.stage),a.canvax.addChild(a.stageTip)},_onInduceHandler:function(a){for(var b=this,d=b._graphs.line.strokeStyle.overs,e=b._tips.opt.context,f=b._tips.opt.disTop,g=(a.info.iGroup,a.info.iNode),h=parseInt(a.info.nodeInfo.stageX),i=parseInt(f),j=[],k=b.dataFrame.graphs.data,l=0,m=k.length;m>l;l++){if(!j[l]){j[l]=[];var n={content:e.prefix.values[l],bold:e.bolds[l],fontSize:e.fontSizes[l],fillStyle:e.fillStyles[l],sign:{enabled:1,trim:1,fillStyle:d[l]}};j[l].push(n)}var n={content:c.numAddSymbol(k[l][g].value),bold:e.bolds[l],fontSize:e.fontSizes[l],fillStyle:e.fillStyles[l],y_align:1};j[l].push(n)}var o={w:b.width,h:b.height};o.tip={x:h,y:i,data:j};var p=b._graphs.getY()-f;o.line={x:h,y:parseInt(b._graphs.getY()),yEnd:-p};for(var j=[],k=a.info.nodesInfoList,l=0,m=k.length;m>l;l++){var n={x:parseInt(k[l].stageX),y:parseInt(k[l].stageY),fillStyle:d[l]};j.push(n)}o.nodes={data:j},b._tips.remove(),b._tips.draw(o)},_offInduceHandler:function(){var a=this;a._tips&&a._tips.remove()}},l},{requires:["dvix/","dvix/utils/tools","dvix/utils/datasection","dvix/event/eventtype","dvix/components/xaxis/xAxis","dvix/components/yaxis/yAxis","dvix/components/back/Back","dvix/components/line/Graphs","dvix/components/tips/Tips"]});