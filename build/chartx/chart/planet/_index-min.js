define("chartx/chart/planet/index",["chartx/chart/index","canvax/shape/Rect","chartx/utils/tools","chartx/utils/gradient-color","chartx/utils/datasection","chartx/utils/dataformat","chartx/components/planet/Graphs","./tips"],function(a,b,c,d,e,f,g,h){var i=a.Canvax;return a.extend({init:function(a,b,c){this.event={This:this,enabled:1,onClick:this._click},this.cx="",this.cy="",this.initCX=60,this.ringDis=10,this.dataFrame={org:[],orgData:[],data:[],back:{rings:0,ringAg:0,rdata:[],data:[]},graphs:{data:[],maxR:0,rdata:[],maxRdata:[],maxYdata:[]}},this.graphs={minR:1,maxR:100,layout:{mode:0},core:{r:{normal:60},fillStyle:{normal:"#70639c"},text:{content:"品牌",place:"center",fillStyle:{normal:"#ffffff"}}},fillStyle:{dNormals:"#b28fce",normals:"#b28fce",overs:["#ff0000","#ff9900","#ffff00","#009900","#00ff00","#0000ff","#660099"]}},this.back={space:"",fillStyle:{first:"#e5dfec",last:"#faf6ff",normals:[]},strokeStyle:{normals:["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"]}},this._bg=null,this._back=null,this._graphs=null,this._tips=null,_.deepExtend(this,c),b=this._trimData(b),this.dataFrame.org=b,_.deepExtend(this.dataFrame,this._initData(b,c)),this.cx=""!=this.cx?this.cx:this.initCX,this.cy=""!=this.cy?this.cy:parseInt(this.height/2),this._countData()},draw:function(){this.stageCore=new i.Display.Sprite({id:"core"}),this.stageBg=new i.Display.Sprite({id:"bg"}),this.stage.addChild(this.stageBg),this.stage.addChild(this.stageCore),this.rotate&&this._rotate(this.rotate),this._initModule(),this._startDraw(),this._drawEnd()},_initData:f,_initModule:function(){this._bg=new i.Display.Sprite,this._back=new g(this.back,this),this._graphs=new g(this.graphs,this)},_trimData:function(a){for(var b=this,c=[],d=_.indexOf(a[0],b.xAxis.field),e=0,f=a.length;f>e;e++)isNaN(a[e][d])||(c[a[e][d]]?-1:c[a[e][d]]=[],c[a[e][d]].push(a[e]));c=_.flatten(c,!0),c=_.compact(c);for(var g=0,h=0,e=0,f=c.length;f>e;e++){var i=c[e][d];h!=i&&(h=i,g++),c[e][d]=g}return c.unshift(a[0]),c},_countData:function(){for(var a=this,b=a.dataFrame.org,e=[],f=a._getDataFromOrg(a.xAxis.field),g=0,h=b.length;h>g;g++){var i=f[g];i&&(e[i]?-1:e[i]=[],e[i].push(b[g+1]))}a.dataFrame.orgData=e;for(var j=[],k=a.dataFrame.xAxis.org[0],g=0,h=k.length;h>g;g++){j[k[g]]?-1:j[k[g]]=[];var l={x:a.cx,y:a.cy,r:{normal:125*(g+1)},fillStyle:{normal:""},lineWidth:{normal:2},strokeStyle:{normal:a.back.strokeStyle.normals[k[g]-1]}};j[k[g]].length<1&&j[k[g]].push(l)}j[0]||(j.shift(),a.dataFrame.back.rings=j.length),a.dataFrame.back.data=c.getChildsArr(j),a.dataFrame.back.ringAg=a._getBackRingAverage();for(var j=a.dataFrame.back.data,m=[],n=a.dataFrame.back.ringAg,g=0,h=j.length;h>g;g++)m[g]=a.graphs.core.r.normal+n*(g+1);a.dataFrame.back.rdata=m,a.back.fillStyle.normals=new d(a.back.fillStyle.first,a.back.fillStyle.last,a.dataFrame.back.rings+1);for(var o=0,g=0,h=j.length;h>g;g++){var l=j[g];l.r={normal:m[g]},l.fillStyle={normal:a.back.fillStyle.normals[g]},0!=g&&((g-o)*n>a.back.space?o=g:l.enabled=0)}a.dataFrame.graphs.maxR=a._getPlanetMaxR();for(var p=a._getDataFromOrg(a.graphs.size.field),q=c.getArrScalesAtArr(p,c.getMaxAtArr(_.clone(p))),m=[],g=0,h=q.length;h>g;g++){var r=q[g],s=a.graphs.minR+(a.dataFrame.graphs.maxR-a.graphs.minR)*r;s=Math.round(s),m.push(s)}a.dataFrame.graphs.rdata=m;for(var t=[],u=[],g=0,h=k.length;h>g;g++){t[k[g]]?-1:t[k[g]]=[];var s=m[g],v=a._getDataFromOrg(a.graphs.info.field,g)[a.graphs.info.content],l={x:100*g,y:100,r:{normal:s},fillStyle:{normal:a.graphs.fillStyle.normals[k[g]-1]},text:{content:v}};if(t[k[g]].push(l),u[k[g]]?-1:u[k[g]]=[],u[k[g]].push(s),u[k[g]].length>1){var w=c.getMaxAtArr(u[k[g]]);u[k[g]]=[w]}}if(!t[0]){t[0]=[];var l={x:a.cx,y:a.cy,r:{normal:a.graphs.core.r.normal},fillStyle:{normal:a.graphs.core.fillStyle.normal},text:a.graphs.core.text,event:{enabled:0}};t[0].unshift(l),u.shift()}a.dataFrame.graphs.data=t,a.dataFrame.graphs.maxRdata=c.getChildsArr(u);for(var x=[],m=a.dataFrame.back.rdata,u=a.dataFrame.graphs.maxRdata,g=0,h=m.length;h>g;g++){var s=2*m[g]>a.height?a.height:m[g];s=2*s<a.height?2*s:s;var y=s-2*u[g]-4;x.push(y)}a.dataFrame.graphs.maxYData=x;var z=[];if(0==a.graphs.layout.mode){for(var p=a._getDataFromOrg(a.yAxis.field),A=c.getArrMergerNumber(p)/p.length,B=0,C=[],g=0,h=k.length;h>g;g++){var i=k[g]-1,D=p[g],E=a.cy+(A-D)/A*(x[i]/2);D>2*A&&(B=D-A>B?D-A:B),D>A&&(C[g]=1),z[g]={y:E}}for(var g=0,h=C.length;h>g;g++){var F=C[g],i=k[g]-1,D=p[g];F&&0!=B&&(z[g].y=a.cy-(D-A)/B*(x[i]/2))}}else{var w=c.getMaxChildArrLength(a.dataFrame.orgData),G=2*w+3,H=_.range(1,G+1),I=parseInt(G/2)+1,J=[I+parseInt(I/2),I,I-parseInt(I/2)],K=J.length,L=[],M=[];M[0]=[0];for(var g=0,h=k.length;h>g;g++){var i=k[g]-1,N=J[(i+1)%K],r=(N-1)/(G-1);z[g]={},z[g].y=a.cy-x[i]/2+r*x[i],k[g-1]&&i==k[g-1]-1&&(L[i+1]?-1:L[i+1]=[],0==L[i+1].length&&L[i+1].push(z[g-1]),L[i+1].push(z[g])),M[i+1]?-1:M[i+1]=[],M[i+1].push(N)}for(var O=-1,g=0,h=M.length;h>g;g++)if(M[g].length>1){M[g]=a._getPlace(a._without(H,M[g-1]),M[g].length,1);for(var F=0,P=M[g].length;P>F;F++){var l=z[O],r=(M[g][F]-1)/(G-1);l.y=a.cy-x[g-1]/2+r*x[g-1],O++}}else O++}for(var g=0,h=z.length;h>g;g++){var l=z[g],i=k[g]-1,s=a.dataFrame.back.rdata[i],Q=l.y-a.cy;l.x=a.cx+a._getDisForRH(s,Q)}for(var O=0,g=0,h=t.length;h>g;g++)for(var F=0,P=t[g].length;P>F;F++){var l=t[g][F];g>0&&(l.x=z[O].x,l.y=z[O].y,O++)}for(var g=1,h=t.length;h>g;g++)for(var F=0,P=t[g].length;P>F;F++){var l=t[g][F];l.ringID=g,l.ID=F+1,l.orgData=a.dataFrame.orgData[g][F],l.fillStyle={normal:a._getGraphsFillStyle(l)}}},_without:function(a,b){for(var c=_.clone(a),d=0,e=b.length;e>d;d++)c=_.without(c,b[d]);return c},_getPlace:function(a,b,c){var d=[];if(1==c)for(var e=0,f=!0,g=0,h=a.length;h>g;g++)f?(d.push(a[e]),e++):d.push(a[a.length-e]),f=!f;return d.length=b,d},_startDraw:function(){var a=this,c=new b({context:{width:a.width,height:a.height,fillStyle:a.back.fillStyle.last}});a._bg.addChild(c),a._back.draw({data:a.dataFrame.back.data.reverse(),event:{enabled:0}}),a._graphs.draw({data:a.dataFrame.graphs.data,event:{enabled:a.event.enabled}})},_drawEnd:function(){this.stageBg.addChild(this._bg),this.stageBg.addChild(this._back.sprite),this.stageCore.addChild(this._graphs.sprite)},_getDataFromOrg:function(a,b){for(var c=this,d=c.dataFrame.data,e=0,f=d.length;f>e;e++){var g=d[e];if(g.field==a){if(isNaN(b))return g.data;if(g.data[b])return g.data[b]}}},_getPlanetMaxR:function(){var a=this,b=0;return b=parseInt((a.dataFrame.back.ringAg-a.ringDis)/2),b=a.graphs.maxR<b?a.graphs.maxR:b},_getBackRingAverage:function(){var a=this;return parseInt((a.width-a.initCX-a.graphs.core.r.normal)/(a.dataFrame.back.rings+.5))},_getDisForRH:function(a,b){return Math.sin(Math.acos(b/a))*a},_click:function(a){var b=this.This;0!=a.ringID&&(a.orgData=b._getOrgData(a.ringID,a.ID)),this.on(a)},_getOrgData:function(a,b){var c=this,d=c.dataFrame.orgData;return d[a][b-1]},_getGraphsFillStyle:function(a){var b=this,c="";return _.isArray(b.graphs.fillStyle.normals)&&(c=b.graphs.fillStyle.normals[a.ringID-1]),_.isFunction(b.graphs.fillStyle.normals)&&(c=b.graphs.fillStyle.normals(a)),_.isString(b.graphs.fillStyle.normals)&&(c=b.graphs.fillStyle.normals),c&&""!=c||(c=b.graphs.fillStyle.dNormals[a.ringID-1]),c}})});