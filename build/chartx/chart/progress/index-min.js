define("chartx/chart/progress/index",["canvax/index","chartx/chart/index","canvax/shape/Sector","canvax/shape/Circle","canvax/animation/Tween"],function(a,b,c,d,e){return b.extend({init:function(a,b,c){this.barWidth=10,this.axisWidth=null,this.normalColor="#E6E6E6",this.progColor="#8d76c4",this.startAngle=-90,this.angleCount=360,this.currRatio=0,this.text={enabled:1,fillStyle:"#666",format:null,fontSize:30},_.deepExtend(this,c),!this.axisWidth&&(this.axisWidth=this.barWidth),!this.r&&(this.r=Math.min(this.width,this.height)/2),this.tween=null},draw:function(b){var d=this.r-(this.barWidth-this.axisWidth)/2,e=this.r-this.axisWidth-(this.barWidth-this.axisWidth)/2;if(this.stage.addChild(this._getCircle(this.startAngle,this.r-this.barWidth/2,this.axisWidth/2,this.normalColor)),this.stage.addChild(this._getCircle(this.startAngle+this.angleCount,this.r-this.barWidth/2,this.axisWidth/2,this.normalColor)),this.stage.addChild(new c({context:{x:this.width/2,y:this.height/2,r:d,r0:e,startAngle:this.startAngle,endAngle:this.startAngle+this.angleCount,fillStyle:this.normalColor,lineJoin:"round"}})),this._circle=this._getCircle(this.startAngle,this.r-this.barWidth/2,this.barWidth/2,this.progColor),this.stage.addChild(this._circle),this.stage.addChild(this._circle.clone()),this.stage.addChild(new c({id:"speed",context:{x:this.width/2,y:this.height/2,r:this.r,r0:this.r-this.barWidth,startAngle:this.startAngle,endAngle:this.startAngle,fillStyle:this.progColor,lineJoin:"round"}})),this.text.enabled){var f=this.currRatio+"%";_.isFunction(this.text.format)&&(f=this.text.format(this.currRatio)),this.stage.addChild(new a.Display.Text(f,{id:"ratioText",context:{x:this.width/2,y:this.height/2,fillStyle:this.text.fillStyle,fontSize:this.text.fontSize,textAlign:"center",textBaseline:"middle"}}))}},_getCircle:function(a,b,c,e){var f=Math.PI/180*a,g=new d({context:{x:Math.cos(f)*b+this.width/2,y:Math.sin(f)*b+this.height/2,r:c,fillStyle:e}});return g},_resetCirclePos:function(a,b){var c=Math.PI/180*a,b=this.r-this.barWidth/2,d=Math.cos(c)*b+this.width/2,e=Math.sin(c)*b+this.height/2;this._circle.context.x=d,this._circle.context.y=e},_setRatio:function(a){var b=a/100*this.angleCount+this.startAngle;this.stage.getChildById("speed").context.endAngle=b,this._resetCirclePos(b)},setRatio:function(a){function b(){d=requestAnimationFrame(b),e.update()}var c=this,d=null,f=700*Math.abs(a-c.currRatio)/100,g=function(){c.tween=new e.Tween({r:c.currRatio}).to({r:a},f).easing(e.Easing.Quadratic.Out).onUpdate(function(){c._setRatio(this.r),c.currRatio=this.r,c.fire("ratioChange",{currRatio:this.r});var a=parseInt(this.r)+"%";_.isFunction(c.text.format)&&(a=c.text.format(this.r)),c.text.enabled&&c.stage.getChildById("ratioText").resetText(a)}).onComplete(function(){cancelAnimationFrame(d)}).start(),b()};g()}})});