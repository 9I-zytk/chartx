KISSY.add("dvix/chart/pregress/recharge",function(a,b){var c=b.Canvax,d=function(){return timer=requestAnimationFrame(d),c.Animation.update(),timer},e=function(a,b){var d=this;this.canvax=new c({el:a}),this.width=parseInt(a.width()),this.height=parseInt(a.height()),this.r=Math.min(this.width,this.height)/2,this._beginAngle=270,this.config=_.extend({ringWidth:50,ringColor:"#f59622",bColor:"#3c3c3c",btnColor:"white",rate:0},b),this.stage=new c.Display.Stage,this.stage.addChild(new c.Shapes.Sector({id:"bg",context:{x:this.width/2,y:this.height/2,r:this.r,r0:this.r-this.config.ringWidth,startAngle:0,endAngle:360,fillStyle:this.config.bColor,lineJoin:"round"}})),this.stage.addChild(new c.Shapes.Sector({id:"rate",context:{x:this.width/2,y:this.height/2,r:this.r,r0:this.r-this.config.ringWidth,startAngle:0,endAngle:0,fillStyle:this.config.ringColor,lineJoin:"round"}}));var e=new c.Shapes.Circle({id:"btn",context:{x:this.width/2,y:this.height/2,r:this.r-this.config.ringWidth,fillStyle:this.config.btnColor}});e.on("tap",function(){d.fire("recharge")}),this.stage.getChildById("rate").on("touch",function(a){d.holdHand(a)}).on("release",function(a){d.releaseHand(a)}),this.stage.getChildById("bg").on("touch",function(a){d.holdHand(a)}).on("release",function(a){d.releaseHand(a)}),this.stage.addChild(e),this.config.rate>0&&this.setRate(this.config.rate,!0),arguments.callee.superclass.constructor.apply(this,arguments)};return c.Base.creatClass(e,b,{draw:function(){this.canvax.addChild(this.stage)},setRate:function(a,b){var e=this.stage.getChildById("rate");this.config.rate=a>100?100:a;var f=this._beginAngle+(180-this.rateToAngle()),g=this._beginAngle-(180-this.rateToAngle());if(b)e.context.startAngle=f,e.context.endAngle=g;else{var h={s:e.context.startAngle,e:e.context.endAngle};new c.Animation.Tween(h).to({s:f,e:g},700).onUpdate(function(){e.context.startAngle=this.s,e.context.endAngle=this.e}).start(),d()}},rateToAngle:function(){return this.config.rate/100*180},holdHand:function(a){var b=this,e=100-this.config.rate,f=b.config.bColor;"rate"==a.target.id&&(e=this.config.rate,f=b.config.ringColor);var g=this.stage.getChildById("btn");new c.Animation.Tween({ringWidth:this.config.ringWidth}).to({ringWidth:3*this.config.ringWidth/4},300).onUpdate(function(){g.context.r=b.r-this.ringWidth}).start();var h=new c.Display.Sprite({id:"holdTextSp",context:{x:g.context.x-g.context.r,y:g.context.y-g.context.r,width:g.context.r,height:g.context.r}}),i=new c.Display.Text("0",{context:{x:g.context.r,y:g.context.r,fillStyle:f,fontSize:25,textAlign:"right",textBaseline:"middle"}}),j=new c.Display.Text(".00%",{context:{x:g.context.r,y:g.context.r+3,fillStyle:f,fontSize:15,textAlign:"left",textBaseline:"middle"}});h.addChild(i),h.addChild(j),this.stage.addChild(h),new c.Animation.Tween({num:0}).to({num:e},300).onUpdate(function(){i.resetText(parseInt(this.num).toString()),j.resetText("."+this.num.toFixed(2).toString().split(".")[1]+"%")}).start(),d()},releaseHand:function(a){c.Animation.removeAll(),this.stage.getChildById("holdTextSp").destroy();var b=this;"rate"==a.target.id;var d=this.stage.getChildById("btn");new c.Animation.Tween({ringWidth:this.r-d.context.r}).to({ringWidth:this.config.ringWidth},500).onUpdate(function(){d.context.r=b.r-this.ringWidth}).start()}}),e},{requires:["dvix/chart/"]});